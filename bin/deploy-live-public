#!/usr/bin/env bash
set -ex

export ETH_FROM=${ETH_FROM:-$(seth rpc eth_coinbase)}

# deploy script for the live and public sai deployment

CHAIN=$(seth chain)

if [ "$CHAIN" = 'kovan' ]; then
    echo "Deploying to kovan..."
    WETH="0x53eccc9246c1e537d79199d0c7231e425a40f896"
    MKR=""
    PIP="0xA944bd4b25C9F186A846fd5668941AA3d3B8425F"
    PEP=""
elif [ "$CHAIN" = 'ethlive' ]; then
    echo "Deploying to ethlive..."
    WETH="0xECF8F87f810EcF450940c9f60066b4a7a501d6A7"
    MKR=""
    PIP=""
    PEP=""
else
    exit
fi

SAI_GEM=$WETH SAI_GOV=$MKR SAI_PIP=$PIP SAI_PEP=$PEP bin/deploy

CHAIN=$(seth chain)

. load-env-$CHAIN

##### configure risk params
# mat = 1.5 axe = 1.2 cap = 100,000,000 gap = 1 [but configurable, +/- 5%]
# tax = way = 1 [default]

seth send $SAI_MOM "setCap(uint256)" $(seth --to-uint256 $(seth --to-wei 100000000 ETH))
seth send $SAI_MOM "setMat(uint256)" $(seth --to-uint256 $(seth --to-wei 1500000000 ETH))
seth send $SAI_MOM "setAxe(uint256)" $(seth --to-uint256 $(seth --to-wei 1200000000 ETH))

# TODO: Specify these initial values:
# seth send $SAI_MOM "setTax(uint256)" $(seth --to-uint256 $(seth --to-wei X ETH))
# seth send $SAI_MOM "setFee(uint256)" $(seth --to-uint256 $(seth --to-wei X ETH))
# seth send $SAI_MOM "setTubGap(uint256)" $(seth --to-uint256 $(seth --to-wei X ETH))
# seth send $SAI_MOM "setTapGap(uint256)" $(seth --to-uint256 $(seth --to-wei X ETH))
# seth send $SAI_MOM "setWay(uint256)" $(seth --to-uint256 $(seth --to-wei X ETH))
